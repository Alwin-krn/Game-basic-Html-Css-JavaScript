<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Catur vs AI Sederhana</title>
    <style>
        :root {
            --bg-color: #302e2b;
            --board-white: #eeeed2;
            --board-black: #769656;
        }

        body {
            background-color: var(--bg-color);
            color: white;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        #status {
            padding: 10px 20px;
            background: #21201d;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
            font-size: 1.2rem;
            border: 2px solid #81b64c;
        }

        #board {
            display: grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            border: 5px solid #262421;
            user-select: none;
        }

        .square {
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 45px;
            cursor: pointer;
            position: relative;
        }

        .white-sq { background-color: var(--board-white); color: black; }
        .black-sq { background-color: var(--board-black); color: black; }
        
        /* Highlight */
        .selected { background-color: #bbc !important; }
        .last-move { background-color: rgba(255, 255, 0, 0.4) !important; }

        /* Hint Langkah */
        .hint::after {
            content: '';
            width: 18px;
            height: 18px;
            background-color: rgba(0,0,0,0.2);
            border-radius: 50%;
            position: absolute;
        }
        .capture-hint::after {
            content: '';
            width: 54px;
            height: 54px;
            border: 4px solid rgba(0,0,0,0.2);
            border-radius: 50%;
            position: absolute;
        }

        .piece { cursor: grab; z-index: 10; }
        .piece.white { color: #fff; text-shadow: 0 0 2px #000; }
        .piece.black { color: #000; }

        /* Tombol Reset */
        button {
            margin-top: 20px;
            padding: 10px 20px;
            background: #81b64c;
            border: none;
            color: white;
            font-weight: bold;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover { background: #6f9e40; }
    </style>
</head>
<body>

    <div id="status">Giliran: ANDA (Putih)</div>
    <div id="board"></div>
    <button onclick="location.reload()">Reset Game</button>

    <script>
        const boardEl = document.getElementById('board');
        const statusEl = document.getElementById('status');

        // --- DATA GAME ---
        const PIECES = {
            w: { k: '♔', q: '♕', r: '♖', b: '♗', n: '♘', p: '♙' },
            b: { k: '♚', q: '♛', r: '♜', b: '♝', n: '♞', p: '♟' }
        };
        
        // Nilai Bidak untuk AI (Semakin tinggi semakin berharga)
        const PIECE_VALUES = { p: 10, n: 30, b: 30, r: 50, q: 90, k: 900 };

        let board = [
            ['r', 'n', 'b', 'q', 'k', 'b', 'n', 'r'],
            ['p', 'p', 'p', 'p', 'p', 'p', 'p', 'p'],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['P', 'P', 'P', 'P', 'P', 'P', 'P', 'P'],
            ['R', 'N', 'B', 'Q', 'K', 'B', 'N', 'R']
        ];

        let turn = 'white'; // white (Player) | black (AI)
        let selectedSquare = null;
        let validMoves = [];

        // --- LOGIKA UTAMA ---
        function renderBoard() {
            boardEl.innerHTML = '';
            for (let r = 0; r < 8; r++) {
                for (let c = 0; c < 8; c++) {
                    const sq = document.createElement('div');
                    sq.className = `square ${(r + c) % 2 === 0 ? 'white-sq' : 'black-sq'}`;
                    
                    // Render Bidak
                    const piece = board[r][c];
                    if (piece) {
                        const span = document.createElement('span');
                        span.className = `piece ${isWhite(piece) ? 'white' : 'black'}`;
                        span.innerText = PIECES[isWhite(piece) ? 'w' : 'b'][piece.toLowerCase()];
                        sq.appendChild(span);
                    }

                    // Highlight
                    if (selectedSquare && selectedSquare.r === r && selectedSquare.c === c) sq.classList.add('selected');
                    if (validMoves.find(m => m.r === r && m.c === c)) {
                        sq.classList.add(piece ? 'capture-hint' : 'hint');
                    }

                    sq.onclick = () => handlePlayerClick(r, c);
                    boardEl.appendChild(sq);
                }
            }
        }

        // --- INTERAKSI PLAYER ---
        function handlePlayerClick(r, c) {
            if (turn !== 'white') return; // Cegah klik saat giliran AI

            const piece = board[r][c];
            const isMyPiece = piece && isWhite(piece);

            if (isMyPiece) {
                selectedSquare = { r, c };
                validMoves = getValidMoves(r, c, piece);
                renderBoard();
            } else if (selectedSquare) {
                const move = validMoves.find(m => m.r === r && m.c === c);
                if (move) {
                    executeMove(selectedSquare.r, selectedSquare.c, r, c);
                } else {
                    selectedSquare = null;
                    validMoves = [];
                    renderBoard();
                }
            }
        }

        // --- EKSEKUSI GERAK ---
        function executeMove(fromR, fromC, toR, toC) {
            board[toR][toC] = board[fromR][fromC];
            board[fromR][fromC] = '';
            
            selectedSquare = null;
            validMoves = [];
            
            // Ganti Giliran
            turn = turn === 'white' ? 'black' : 'white';
            statusEl.innerText = turn === 'white' ? "Giliran: ANDA (Putih)" : "Giliran: KOMPUTER (Berpikir...)";
            renderBoard();

            // Jika giliran AI, jalankan AI setelah jeda (biar terlihat mikir)
            if (turn === 'black') {
                setTimeout(makeAIMove, 500); 
            }
        }

        // --- OTAK AI (ARTIFICIAL INTELLIGENCE) ---
        function makeAIMove() {
            // 1. Kumpulkan semua bidak hitam
            let aiPieces = [];
            for(let r=0; r<8; r++) {
                for(let c=0; c<8; c++) {
                    if(board[r][c] && !isWhite(board[r][c])) {
                        aiPieces.push({r, c, type: board[r][c]});
                    }
                }
            }

            // 2. Cari semua langkah legal untuk setiap bidak hitam
            let allMoves = [];
            aiPieces.forEach(p => {
                const moves = getValidMoves(p.r, p.c, p.type);
                moves.forEach(m => {
                    allMoves.push({
                        fromR: p.r, fromC: p.c,
                        toR: m.r, toC: m.c,
                        score: 0 // Skor awal
                    });
                });
            });

            if (allMoves.length === 0) {
                alert("Game Over! AI tidak bisa bergerak.");
                return;
            }

            // 3. BERI NILAI (Scoring)
            // AI akan memprioritaskan memakan bidak musuh
            allMoves.forEach(move => {
                const target = board[move.toR][move.toC];
                if (target) {
                    // Skor = Nilai bidak yang dimakan
                    move.score = PIECE_VALUES[target.toLowerCase()] || 0;
                }
                
                // Tambahan sedikit acak agar tidak terlalu robot
                move.score += Math.random() * 5; 
            });

            // 4. Pilih langkah dengan skor tertinggi
            allMoves.sort((a, b) => b.score - a.score);
            const bestMove = allMoves[0];

            // 5. Jalankan
            executeMove(bestMove.fromR, bestMove.fromC, bestMove.toR, bestMove.toC);
        }

        // --- LOGIKA ATURAN CATUR (Sama seperti V4) ---
        function getValidMoves(r, c, piece) {
            const moves = [];
            const type = piece.toLowerCase();
            const color = isWhite(piece) ? 'white' : 'black';
            
            const directions = {
                'r': [[0,1], [0,-1], [1,0], [-1,0]],
                'n': [[-2,-1], [-2,1], [-1,-2], [-1,2], [1,-2], [1,2], [2,-1], [2,1]],
                'b': [[1,1], [1,-1], [-1,1], [-1,-1]],
                'q': [[0,1], [0,-1], [1,0], [-1,0], [1,1], [1,-1], [-1,1], [-1,-1]],
                'k': [[0,1], [0,-1], [1,0], [-1,0], [1,1], [1,-1], [-1,1], [-1,-1]]
            };

            if (type === 'p') { // Pion
                const dir = color === 'white' ? -1 : 1;
                const startRow = color === 'white' ? 6 : 1;
                if (isEmpty(r + dir, c)) {
                    moves.push({ r: r + dir, c: c });
                    if (r === startRow && isEmpty(r + dir * 2, c)) moves.push({ r: r + dir * 2, c: c });
                }
                if (isEnemy(r + dir, c - 1, color)) moves.push({ r: r + dir, c: c - 1 });
                if (isEnemy(r + dir, c + 1, color)) moves.push({ r: r + dir, c: c + 1 });
            } 
            else if (type === 'n' || type === 'k') { // Kuda & Raja (Langkah tunggal)
                const dirs = type === 'n' ? directions.n : directions.k;
                dirs.forEach(d => {
                    const nr = r + d[0], nc = c + d[1];
                    if (onBoard(nr, nc) && (isEmpty(nr, nc) || isEnemy(nr, nc, color))) {
                        moves.push({ r: nr, c: nc });
                    }
                });
            } 
            else { // Benteng, Gajah, Ratu (Sliding)
                const dirs = directions[type];
                dirs.forEach(d => {
                    let i = 1;
                    while (true) {
                        const nr = r + d[0] * i, nc = c + d[1] * i;
                        if (!onBoard(nr, nc)) break;
                        if (isEmpty(nr, nc)) {
                            moves.push({ r: nr, c: nc });
                        } else {
                            if (isEnemy(nr, nc, color)) moves.push({ r: nr, c: nc });
                            break;
                        }
                        i++;
                    }
                });
            }
            return moves;
        }

        // --- HELPER FUNCTIONS ---
        function isWhite(p) { return p === p.toUpperCase(); }
        function onBoard(r, c) { return r >= 0 && r < 8 && c >= 0 && c < 8; }
        function isEmpty(r, c) { return onBoard(r, c) && board[r][c] === ''; }
        function isEnemy(r, c, myColor) {
            if (!onBoard(r, c) || board[r][c] === '') return false;
            return (isWhite(board[r][c]) ? 'white' : 'black') !== myColor;
        }

        renderBoard();
    </script>
</body>
</html>